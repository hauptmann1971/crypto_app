# .github/workflows/docker-build.yml
name: Build Docker Image

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ—ï¸ Build Docker image
      run: |
        echo "=== Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Docker Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ° ==="
        docker build -t crypto-app:latest .
        echo "âœ… ĞĞ±Ñ€Ğ°Ğ· ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ±Ñ€Ğ°Ğ½"

    - name: ğŸ§ª Test Docker image
      run: |
        echo "=== Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ° ==="
        docker run --rm crypto-app:latest python -c "import flask; print('âœ… Flask ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½'); print('âœ… ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ')"

    - name: ğŸ’¾ Save Docker image
      run: |
        echo "=== Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ° ==="
        docker save crypto-app:latest -o crypto-app.tar
        echo "Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ°: $(du -h crypto-app.tar | cut -f1)"

    - name: ğŸ“¤ Upload Docker image
      uses: actions/upload-artifact@v4
      with:
        name: crypto-app-docker-image
        path: crypto-app.tar
        retention-days: 30

    - name: âœ… Success message
      if: success()
      run: |
        echo "ğŸ‰ DOCKER ĞĞ‘Ğ ĞĞ— Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞ Ğ¡ĞĞ‘Ğ ĞĞ!"
        echo ""
        echo "ğŸ“¦ ĞĞ±Ñ€Ğ°Ğ·: crypto-app:latest"
        echo "ğŸ“ Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ: Ğ Ğ°Ğ·Ğ´ĞµĞ» Artifacts â†’ crypto-app-docker-image"
        echo ""
        echo "ğŸš€ ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°:"
        echo "   docker load -i crypto-app.tar"
        echo "   docker run -d -p 5000:5000 --name crypto-app crypto-app:latest"
        echo "   ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ: http://localhost:5000"