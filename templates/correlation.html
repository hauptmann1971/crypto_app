<!-- templates/correlation.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Корреляция с Bitcoin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .progress-container {
            margin: 20px 0;
        }
        .crypto-item {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>Корреляция криптовалют с Bitcoin</h1>

        <div class="alert alert-info">
            <strong>Рекомендации:</strong>
            <ul>
                <li>Начните с малого периода (30 дней) и дневного таймфрейма</li>
                <li>Выбирайте популярные криптовалюты (ETH, BNB, SOL, ADA)</li>
                <li>Ограничьте выбор 3-5 криптовалютами для скорости</li>
                <li>Если возникают ошибки - уменьшите период или количество криптовалют</li>
            </ul>
        </div>

        <form method="POST">
            <div class="row">
                <div class="col-md-6">
                    <h4>Выберите криптовалюты:</h4>
                    {% for crypto in ['ethereum', 'binancecoin', 'solana', 'cardano', 'ripple', 'polkadot', 'dogecoin', 'matic-network'] %}
                    <div class="form-check crypto-item">
                        <input class="form-check-input" type="checkbox" name="cryptos"
                               value="{{ crypto }}" id="{{ crypto }}"
                               {% if crypto in selected_cryptos %}checked{% endif %}>
                        <label class="form-check-label" for="{{ crypto }}">
                            {{ crypto.upper() }}
                        </label>
                    </div>
                    {% endfor %}
                </div>

                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Период:</label>
                        <select class="form-select" name="days">
                            {% for option in days_options %}
                            <option value="{{ option.value }}" {% if option.value == days|string %}selected{% endif %}>
                                {{ option.label }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Таймфрейм:</label>
                        <select class="form-select" name="timeframe">
                            {% for option in timeframe_options %}
                            <option value="{{ option.value }}" {% if option.value == timeframe %}selected{% endif %}>
                                {{ option.label }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Валюта:</label>
                        <select class="form-select" name="currency">
                            <option value="usd" {% if currency == 'usd' %}selected{% endif %}>USD</option>
                            <option value="eur" {% if currency == 'eur' %}selected{% endif %}>EUR</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary">Рассчитать</button>
                </div>
            </div>
        </form>

        {% if error %}
        <div class="alert alert-danger mt-3">
            {{ error }}
            {% if failed_calculations %}
            <br><strong>Не удалось для:</strong> {{ failed_calculations|join(', ') }}
            {% endif %}
        </div>
        {% endif %}

        {% if successful_calculations > 0 %}
        <div class="alert alert-success mt-3">
            Успешно рассчитано корреляций: <strong>{{ successful_calculations }}</strong>
        </div>
        {% endif %}

        {% if correlation_results %}
        <h2 class="mt-4">Результаты</h2>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Криптовалюта</th>
                        <th>Корреляция</th>
                        <th>Сила</th>
                        <th>Направление</th>
                        <th>Beta</th>
                    </tr>
                </thead>
                <tbody>
                    {% for coin_id, data in correlation_results.items() %}
                    <tr>
                        <td><strong>{{ coin_id.upper() }}</strong></td>
                        <td>
                            {% if data.correlation > 0 %}
                            <span class="text-success">{{ "%.3f"|format(data.correlation) }}</span>
                            {% else %}
                            <span class="text-danger">{{ "%.3f"|format(data.correlation) }}</span>
                            {% endif %}
                        </td>
                        <td>{{ data.correlation_strength }}</td>
                        <td>
                            {% if data.correlation_direction == 'positive' %}
                            <span class="badge bg-success">Положительная</span>
                            {% else %}
                            <span class="badge bg-danger">Отрицательная</span>
                            {% endif %}
                        </td>
                        <td>{{ "%.3f"|format(data.beta) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
</body>
</html>