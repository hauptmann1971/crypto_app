<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä–∏–ø—Ç–æ–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .btn-group-vertical .btn {
            margin-bottom: 10px;
        }
        .rate-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #198754;
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">üí∞ –ö—Ä–∏–ø—Ç–æ–∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä</h1>
            </div>
        </div>

        <!-- –§–ª–µ—à-—Å–æ–æ–±—â–µ–Ω–∏—è -->
        <div class="row">
            <div class="col-12">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else 'success' if category == 'success' else 'warning' }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>
        </div>

        <div class="row">
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∫—É—Ä—Å–æ–≤</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="crypto" class="form-label">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞:</label>
                                    <select class="form-select" id="crypto" name="crypto" required>
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É</option>
                                        {% for crypto in cryptos %}
                                            <option value="{{ crypto }}" {% if crypto == 'bitcoin' %}selected{% endif %}>
                                                {{ crypto }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                
                                <div class="col-md-6">
                                    <label for="currency" class="form-label">–í–∞–ª—é—Ç–∞:</label>
                                    <select class="form-select" id="currency" name="currency" required>
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É</option>
                                        {% for currency in currencies %}
                                            <option value="{{ currency }}" {% if currency == 'usd' %}selected{% endif %}>
                                                {{ currency|upper }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                                
                                <div class="col-12">
                                    <button type="submit" class="btn btn-primary btn-lg w-100">
                                        –ü–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å
                                    </button>
                                </div>
                            </div>
                        </form>

                        <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
                        {% if rate %}
                            <div class="rate-display">
                                –¢–µ–∫—É—â–∏–π –∫—É—Ä—Å: {{ rate }}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h5>
                    </div>
                    <div class="card-body">
                        <div class="btn-group-vertical w-100">
                            <!-- –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
                            <a href="{{ url_for('chart') }}" class="btn btn-info">
                                üìä –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫
                            </a>

                            <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü -->
                            <a href="{{ url_for('show_crypto_table') }}" class="btn btn-outline-primary">
                                üìã –¢–∞–±–ª–∏—Ü–∞ –∫—É—Ä—Å–æ–≤
                            </a>
                            
                            <a href="{{ url_for('show_log_table') }}" class="btn btn-outline-secondary">
                                üìù –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                            </a>

                            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î -->
                            {% if db_connected %}
                                <form method="POST" action="{{ url_for('disconnect_db') }}" class="d-grid">
                                    <button type="submit" class="btn btn-warning">
                                        üîå –û—Ç–∫–ª—é—á–∏—Ç—å –ë–î
                                    </button>
                                </form>
                            {% else %}
                                <form method="POST" action="{{ url_for('connect_db') }}" class="d-grid">
                                    <button type="submit" class="btn btn-success">
                                        üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å –ë–î
                                    </button>
                                </form>
                            {% endif %}
                        </div>

                        <!-- –°—Ç–∞—Ç—É—Å –ë–î -->
                        <div class="mt-3 p-3 rounded {{ 'bg-success' if db_connected else 'bg-danger' }} text-white">
                            <small>
                                <strong>–°—Ç–∞—Ç—É—Å –ë–î:</strong> 
                                {{ '–ü–æ–¥–∫–ª—é—á–µ–Ω–∞' if db_connected else '–û—Ç–∫–ª—é—á–µ–Ω–∞' }}
                            </small>
                        </div>
                    </div>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6 class="card-title mb-0">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>
                    </div>
                    <div class="card-body">
                        <small class="text-muted">
                            <strong>–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:</strong><br>
                            ‚Ä¢ –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞: Bitcoin<br>
                            ‚Ä¢ –í–∞–ª—é—Ç–∞: USD<br>
                            <strong>–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:</strong> CoinGecko API<br>
                            <strong>–î–æ—Å—Ç—É–ø–Ω–æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç:</strong> {{ cryptos|length }}<br>
                            <strong>–î–æ—Å—Ç—É–ø–Ω–æ –≤–∞–ª—é—Ç:</strong> {{ currencies|length }}
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã–º –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h6 class="card-title mb-0">üöÄ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã</h6>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-primary btn-sm" onclick="selectCrypto('bitcoin')">
                                Bitcoin
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="selectCrypto('ethereum')">
                                Ethereum
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="selectCrypto('binancecoin')">
                                Binance Coin
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="selectCrypto('ripple')">
                                Ripple
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="selectCrypto('cardano')">
                                Cardano
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="selectCrypto('solana')">
                                Solana
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –≤–∞–ª—é—Ç–∞–º -->
        <div class="row mt-3">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h6 class="card-title mb-0">üí± –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–∞–ª—é—Ç—ã</h6>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-success btn-sm" onclick="selectCurrency('usd')">
                                USD
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectCurrency('eur')">
                                EUR
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectCurrency('gbp')">
                                GBP
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectCurrency('jpy')">
                                JPY
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="selectCurrency('rub')">
                                RUB
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function selectCrypto(crypto) {
            document.getElementById('crypto').value = crypto;
        }

        function selectCurrency(currency) {
            document.getElementById('currency').value = currency;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –∞–ª–µ—Ä—Ç–æ–≤ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(function() {
            var alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                var bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–Ω–∞—á–µ–Ω–∏—è—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            const cryptoSelect = document.getElementById('crypto');
            const currencySelect = document.getElementById('currency');
            
            if (cryptoSelect.value === 'bitcoin' && currencySelect.value === 'usd') {
                console.log('–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: Bitcoin/USD');
            }
        });
    </script>
</body>
</html>